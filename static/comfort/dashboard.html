<!DOCTYPE html>
<html lang="en">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<head>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>Comfort Estimation- Dashboard</title>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/zepto/1.1.6/zepto.min.js"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/zepto/1.1.6/modules/fx.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>  
  <!-- Custom fonts for this template-->
  <link href="chartist.min.css" rel="stylesheet">
  <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">

  <!-- Custom styles for this template-->
  <link href="css/sb-admin-2.min.css" rel="stylesheet">

</head>

<body id="page-top">

  <!-- Page Wrapper -->
  <div id="wrapper">

    <!-- Sidebar -->
    <ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion" id="accordionSidebar">

      <!-- Sidebar - Brand -->
      <a class="sidebar-brand d-flex align-items-center justify-content-center" href="action.html">
        <div class="sidebar-brand-text mx-3">Building Co-Optimization</div>
      </a>

      <!-- Divider -->
      <hr class="sidebar-divider my-0">

      <!-- Nav Item - Dashboard -->
      <li class="nav-item active">
        <a class="nav-link" href="index.html">
          <i class="fas fa-fw fa-tachometer-alt"></i>
          <span>Comfort Feedback</span></a>
      </li>
      <li class="nav-item active">
        <a class="nav-link" href="action.html">
          <i class="fas fa-fw fa-tachometer-alt"></i>
          <span>Recommendations</span></a>
      </li>
      <li class="nav-item active">
        <a class="nav-link" href="dashboard.html">
          <i class="fas fa-fw fa-tachometer-alt"></i>
          <span>Dashboard</span></a>
      </li>


      <!-- Divider -->
      <hr class="sidebar-divider">
      

      <!-- Sidebar Toggler (Sidebar) -->
      <div class="text-center d-none d-md-inline">
        <button class="rounded-circle border-0" id="sidebarToggle"></button>
      </div>

    </ul>
    <!-- End of Sidebar -->

    <!-- Content Wrapper -->
    <div id="content-wrapper" class="d-flex flex-column">

      <!-- Main Content -->
      <div id="content">

        <!-- Topbar -->
        <nav class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow">

          <!-- Sidebar Toggle (Topbar) -->
          <button id="sidebarToggleTop" class="btn btn-link d-md-none rounded-circle mr-3">
            <i class="fa fa-bars"></i>
          </button>

          <!-- Topbar Search -->
          <a href="http://icsl.ee.columbia.edu">
            <img height="50" src="ICSL_Logo.png">
          </a>
          <form class="d-none d-sm-inline-block form-inline mr-auto ml-md-3 my-2 my-md-0 mw-100 navbar-search">
            <div class="input-group">
              <input type="text" class="form-control bg-light border-0 small" placeholder="Search for..." aria-label="Search" aria-describedby="basic-addon2">
              <div class="input-group-append">
                <button class="btn btn-primary" type="button">
                  <i class="fas fa-search fa-sm"></i>
                </button>
              </div>
            </div>
          </form>

          <!-- Topbar Navbar -->
          <ul class="navbar-nav ml-auto">

            <!-- Nav Item - Search Dropdown (Visible Only XS) -->
            <li class="nav-item dropdown no-arrow d-sm-none">
              <a class="nav-link dropdown-toggle" href="#" id="searchDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="fas fa-search fa-fw"></i>
              </a>
              <!-- Dropdown - Messages -->
              <div class="dropdown-menu dropdown-menu-right p-3 shadow animated--grow-in" aria-labelledby="searchDropdown">
                <form class="form-inline mr-auto w-100 navbar-search">
                  <div class="input-group">
                    <input type="text" class="form-control bg-light border-0 small" placeholder="Search for..." aria-label="Search" aria-describedby="basic-addon2">
                    <div class="input-group-append">
                      <button class="btn btn-primary" type="button">
                        <i class="fas fa-search fa-sm"></i>
                      </button>
                    </div>
                  </div>
                </form>
              </div>
            </li>

            <!-- Nav Item - Alerts -->
            <li class="nav-item dropdown no-arrow mx-1">
              <a class="nav-link dropdown-toggle" href="#" id="alertsDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="fas fa-bell fa-fw"></i>
                <!-- Counter - Alerts -->
                <span class="badge badge-danger badge-counter">0</span>
              </a>
              <!-- Dropdown - Alerts -->
              <div class="dropdown-list dropdown-menu dropdown-menu-right shadow animated--grow-in" aria-labelledby="alertsDropdown">
                <h6 class="dropdown-header">
                  Alerts Center
                </h6>
                <a class="dropdown-item text-center small text-gray-500" href="#">Show All Alerts</a>
              </div>
            </li>

            <!-- Nav Item - Messages -->
            <li class="nav-item dropdown no-arrow mx-1">
              <a class="nav-link dropdown-toggle" href="#" id="messagesDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="fas fa-envelope fa-fw"></i>
                <!-- Counter - Messages -->
                <span class="badge badge-danger badge-counter">0</span>
              </a>
              <!-- Dropdown - Messages -->
              <div class="dropdown-list dropdown-menu dropdown-menu-right shadow animated--grow-in" aria-labelledby="messagesDropdown">
                <h6 class="dropdown-header">
                  Message Center
                </h6>
                <a class="dropdown-item text-center small text-gray-500" href="#">Read More Messages</a>
              </div>
            </li>

            <div class="topbar-divider d-none d-sm-block"></div>

            <!-- Nav Item - User Information -->
            <li class="nav-item dropdown no-arrow">
              <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <span id="ParticipantID" class="mr-2 d-none d-lg-inline text-gray-600 small">Fred Jiang</span>
              </a>
              <!-- Dropdown - User Information -->
              <div class="dropdown-menu dropdown-menu-right shadow animated--grow-in" aria-labelledby="userDropdown">
                <a class="dropdown-item" href="#">
                  <i class="fas fa-user fa-sm fa-fw mr-2 text-gray-400"></i>
                  Profile
                </a>
                <a class="dropdown-item" href="#">
                  <i class="fas fa-cogs fa-sm fa-fw mr-2 text-gray-400"></i>
                  Settings
                </a>
                <a class="dropdown-item" href="#">
                  <i class="fas fa-list fa-sm fa-fw mr-2 text-gray-400"></i>
                  Activity Log
                </a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="#" data-toggle="modal" data-target="#logoutModal">
                  <i class="fas fa-sign-out-alt fa-sm fa-fw mr-2 text-gray-400"></i>
                  Logout
                </a>
              </div>
            </li>

          </ul>

        </nav>
        <!-- End of Topbar -->

        <!-- Begin Page Content -->
        <div class="container-fluid">

          <!-- Page Heading -->
              <div class="d-sm-flex align-items-center justify-content-between mb-4">
                <h1 class="h3 mb-0 text-gray-800">Dashboard</h1>
<!--		<button type="button" data-toggle="modal" class="d-none d-sm-inline-block btn btn-sm btn-primary" data-target="#instructionsModal">Instructions</button>-->
              </div>
	  <div class="row">
            <div class="col-xs-6 col-md-8">
	      <div class="card border-left-primary shadow h-100 py-2">
	        <div class="card-body">
	          <canvas width="100" id="BarChart"></canvas>
	        </div>
	      </div>
            </div>
            <div class="col-xs-6 col-md-4">
	      <div class="card border-left-dark shadow h-100">
		<div class="card-header" >Recommendation Breakdown</div>
	        <div class="card-body">
	          <canvas width="80%" height="80%" id="pieChart"></canvas>
	        </div>
	      </div>
            </div>
	  </div>
	  </br>
          <div class="row">
            <div class="col-xs-4 col-md-4">
	      <div class="card border-left-danger shadow h-100">
		<div class="card-header" >Most Frequent Recommendation</div>
	        <div class="card-body">
		    <p id="MFR" class="card-text"></p>
		    <div class="progress">
  <div id="MFRBar" class="progress-bar bg-danger" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</div>
</div>
	        </div>
	      </div>
            </div>
            <div class="col-xs-4 col-md-4">
	      <div class="card border-left-success shadow h-100">
		<div class="card-header" >Energy</div>
	        <div class="card-body">
		    <p id="Energy" class="card-text"></p>
	        </div>
	      </div>
            </div>
            <div class="col-xs-4 col-md-4">
	      <div class="card border-left-info shadow h-100">
		<div class="card-header" >Comfort</div>
	        <div class="card-body">
		    <p id="Comfort" class="card-text"></p>
	        </div>
	      </div>
            </div>
	  </div>
	  </br>
          <div class="row">
            <div class="col-xs-4 col-md-4">
	      <div class="card border-left-info shadow h-100">
		<div class="card-header" >Air Quality</div>
	        <div class="card-body">
		    <p id="AQ" class="card-text"></p>
	        </div>
	      </div>
            </div>
            <div class="col-xs-8 col-md-8">
	      <div class="card border-left-info shadow h-100">
		<div class="card-header" >Rewards</div>
	        <div class="card-body">
<!--		    <p id="Rewards" class="card-text"></p>-->
		    <div class="progress">
  <div id="RewardBar" class="progress-bar bg-success" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</div>
</div>
	        </div>
	      </div>
            </div>
          </div>
	  </br>
        </div>


      </div>
    </div>
  </div>
      <!-- End of Main Content -->

      <!-- Footer -->
      <footer class="sticky-footer bg-white">
        <div class="container my-auto">
          <div class="copyright text-center my-auto">
            <span>Copyright &copy;  Intelligent and Connected Systems Laboratory 2021</span>
          </div>
        </div>
      </footer>
      <!-- End of Footer -->

    </div>
    <!-- End of Content Wrapper -->

  </div>
  <!-- End of Page Wrapper -->

  <!-- Scroll to Top Button-->
  <a class="scroll-to-top rounded" href="#page-top">
    <i class="fas fa-angle-up"></i>
  </a>

  <!-- Logout Modal-->
  <div class="modal fade" id="instructionsModal" tabindex="-2" role="dialog" aria-labelledby="instructionModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Recommendation Instructions</h5>
          <button class="close" type="button" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">x</span>
          </button>
        </div>
        <div class="modal-body">Select a recommendation from each list. Your selection should be based on the recommendation you would be most likely to perform, given the difficulty of the action and the benefits (and costs) of the actions. To submit feedback, click the Submit button at the bottom of the page. You can also choose to not select any actions from the list (if none of the actions are worthwhile). If that is the case, please still click the Submit button so we can record your feedback.
        </div>
        <div class="modal-footer">
	  <button class="btn btn-secondary" type="button" data-dismiss="modal"> Close </button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Ready to Leave?</h5>
          <button class="close" type="button" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">Ã—</span>
          </button>
        </div>
        <div class="modal-body">Select "Logout" below if you are ready to end your current session.</div>
        <div class="modal-footer">
          <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
          <a class="btn btn-primary" href="login.html" onclick="localStorage.removeItem('participantID');">Logout</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap core JavaScript-->
  <script src="vendor/jquery/jquery.min.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

  <!-- Core plugin JavaScript-->
  <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

  <!-- Custom scripts for all pages-->
  <script src="js/sb-admin-2.min.js"></script>

  <!-- Page level plugins -->
  <script src="vendor/chart.js/Chart.min.js"></script>
  <script type="text/javascript">
    if (localStorage.getItem("participantID") === null) {
      window.location.href = "login.html";
    }
    var PID = JSON.parse(localStorage.getItem("participantID"))["PID"];
    var PData = {
        "PID": PID
    };
    var json_data = JSON.stringify(PData);
    $.post('/api/appSupport/webLogin/', json_data,
        function(payload){
          console.log('Received data', payload);
          if (!payload.success) {
            window.location.href = "login.html";
          }
        }, 'json');
    var PID = JSON.parse(localStorage.getItem("participantID"))["PID"];
    console.log(PID);
    document.getElementById("ParticipantID").innerHTML = "Participant " + PID;
  </script>

  <script type="text/javascript">
    $(function () {
      $('[data-toggle="popover"]').popover()
    })
    $('.popover-dismiss').popover({
      trigger: 'focus'
    })

    function enablePopovers() {
      $('[data-toggle="popover"]').popover();
      $('.popover-dismiss').popover({
        trigger: 'focus'
      });
    }
  </script>
  <script type="text/javascript">
    function dashboardData() {
      var PData = {
          "PID": PID
      };
      var json_data = JSON.stringify(PData);
      $.post('/api/appSupport/dashboardRequest/', json_data,
        function(payload){
          console.log('Received data', payload);
          if (!payload.max_title) {
	    console.log(payload);
	    return;
          }
	  var energy = payload.cum_energy;
	  var comfort = payload.cum_comfort;
	  var aq = payload.cum_aq;
	  var max_title = payload.max_title;
	  var max_title_count = payload.max_title_count;
	  var setpoints = payload.setpoints;
	  var moves = payload.moves;
	  var unknown = payload.unknown;
	  var totalRecs = setpoints + moves + unknown;
	  if (totalRecs == 0) {
	    totalRecs = 1;
	  }
	  var percent = max_title_count *100 / totalRecs;
	  percent = Math.round(percent);
	  var moves_percent = moves*100 / totalRecs;
	  var setpoints_percent = setpoints*100 / totalRecs;
	  var rewards_percent = (totalRecs % 15) * 100 / 15; 
	  console.log("Percent", percent);
	  document.getElementById('RewardBar').style="width: " + Math.round(rewards_percent) + "%;";
	  document.getElementById('RewardBar').innerHTML = Math.round(rewards_percent) + "%";
    	  document.getElementById('MFR').innerHTML = max_title;
    	  document.getElementById('MFRBar').style = "width: " + percent + "%;";
    	  document.getElementById('MFRBar').innerHTML = percent + "%";
	  document.getElementById('Energy').innerHTML = "Energy Saved:</br>" + energy + " Wh";
	  document.getElementById('Comfort').innerHTML = "Comfort Improvement:</br>" + comfort + "%";
	  document.getElementById('AQ').innerHTML = "Air Quality Improvement:</br>" + aq + "%";
	  $('#MFRBar').attr("aria-valuenow",percent); 

	  var ctxP = document.getElementById("pieChart").getContext('2d');
          var myPieChart = new Chart(ctxP, {
          type: 'pie',
          data: {
            labels: ["Move Recommendations", "Setpoint Recommendations"],
              datasets: [{
            data: [moves_percent, setpoints_percent],
            backgroundColor: ["#F7464A", "#46BFBD"],
            hoverBackgroundColor: ["#FF5A5E", "#5AD3D1"]
          }]
        },
        options: {
          responsive: true
        }
      });
	  var ctx = document.getElementById("BarChart").getContext("2d");
	  var data = {
	    labels: ["Energy", "Comfort", "Air Quality"],
	    datasets: [
	      {
	        label: "Participant",
	        fillColor: "blue",
	 	backgroundColor: [
'rgba(255, 99, 132, 0.6)',
'rgba(255, 99, 132, 0.6)',
'rgba(255, 99, 132, 0.6)'],
		data: [energy, comfort, aq],
	      },
	      {
	        label: "Total",
	        fillColor: "red",
		backgroundColor: [
'rgba(54, 162, 235, 0.6)',
'rgba(54, 162, 235, 0.6)',
'rgba(54, 162, 235, 0.6)'],
	        data: [energy, comfort, aq],
	      }
	    ]
	  };
	  var myBarChart = new Chart(ctx, {type: 'bar',data: data, options:{barValueSpacing: 20}});



        }, 'json');
    }
    dashboardData();
  </script>
<script>
const labels = [
  'January',
  'February',
  'March',
  'April',
  'May',
  'June',
];
const data = {
  labels: labels,
  datasets: [{
    label: 'My First dataset',
    backgroundColor: 'rgb(255, 99, 132)',
    borderColor: 'rgb(255, 99, 132)',
    data: [0, 10, 5, 2, 20, 30, 45],
  }]
};
const config = {
  type: 'line',
  data,
  options: {}
};


</script>
</body>

</html>
